from androguard.misc import AnalyzeAPK


class ApkPreprocessing:

    @staticmethod
    def get_apk(apk):
        a, d, dx = AnalyzeAPK(apk)
        return a

    @staticmethod
    def returnIntentName(itemtype, name):
        try:
            for action, intent_name in a.get_intent_filters(itemtype, name).items():
                return intent_name
        except:
            return ['No intent']

    def get_permissions(self, apk):
        apk = ApkPreprocessing.get_apk(apk)
        substring = "permission."
        permission_list = []
        for permission in apk.get_permissions():
            if substring in permission:
                head, sep, tail = permission.partition('permission.')
                permission_list.append(tail)
        return permission_list

    def get_intents(self, apk):
        apk = ApkPreprocessing.get_apk(apk)
        receivers = apk.get_receivers()
        receiverString = 'receiver'
        intent_list = []
        for receiver in receivers:
            intents = ApkPreprocessing.returnIntentName(receiverString, receiver)
            if intents is not None:
                for intent in intents:
                    if receiverString in intent:
                        intent_list.append(intent)
        return intent_list
